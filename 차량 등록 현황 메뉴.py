import plotly.express as px # ì¶”ê°€


# (ì„ì‹œ) ì°¨ëŸ‰ ë“±ë¡ ë°ì´í„°
@st.cache_data
def load_car_data():
    cars = pd.read_csv("ìë™ì°¨ë“±ë¡í˜„í™©ë³´ê³ _ìë™ì°¨ë“±ë¡ëŒ€ìˆ˜í˜„í™© ì‹œë„ë³„ (201101 ~ 202502).csv", encoding="cp949", skiprows=5)
    cars.columns = ['ì¼ì‹œ', 'ì‹œë„ëª…', 'ì‹œêµ°êµ¬', 'ìŠ¹ìš©_ê´€ìš©', 'ìŠ¹ìš©_ìê°€ìš©', 'ìŠ¹ìš©_ì˜ì—…ìš©', 'ìŠ¹ìš©_ê³„',
                    'ìŠ¹í•©_ê´€ìš©', 'ìŠ¹í•©_ìê°€ìš©', 'ìŠ¹í•©_ì˜ì—…ìš©', 'ìŠ¹í•©_ê³„',
                    'í™”ë¬¼_ê´€ìš©', 'í™”ë¬¼_ìê°€ìš©', 'í™”ë¬¼_ì˜ì—…ìš©', 'í™”ë¬¼_ê³„',
                    'íŠ¹ìˆ˜_ê´€ìš©', 'íŠ¹ìˆ˜_ìê°€ìš©', 'íŠ¹ìˆ˜_ì˜ì—…ìš©', 'íŠ¹ìˆ˜_ê³„',
                    'ì´ê³„_ê´€ìš©', 'ì´ê³„_ìê°€ìš©', 'ì´ê³„_ì˜ì—…ìš©', 'ì´ê³„']
    cars = cars[(cars['ì‹œë„ëª…'] == 'ì„œìš¸') & (cars['ì‹œêµ°êµ¬'] == 'ê°•ë‚¨êµ¬')]
    cars['ì¼ì‹œ'] = pd.to_datetime(cars['ì¼ì‹œ'])
    cars['ìŠ¹ìš©_ì˜ì—…ìš©'] = cars['ìŠ¹ìš©_ì˜ì—…ìš©'].str.replace(',', '').astype(int)
    return cars[['ì¼ì‹œ', 'ìŠ¹ìš©_ì˜ì—…ìš©']]

# ì°¨ëŸ‰ ë“±ë¡ í˜„í™© ë©”ë‰´
if menu == "ì°¨ëŸ‰ ë“±ë¡ í˜„í™©":
    st.title("ğŸš— ë²•ì¸ ì°¨ëŸ‰ ë“±ë¡ í†µê³„")

    df = load_car_data()
    df_recent = df[-24:].reset_index(drop=True)

    avg_2023 = df_recent[:12]['ìŠ¹ìš©_ì˜ì—…ìš©'].mean()
    avg_2024 = df_recent[12:]['ìŠ¹ìš©_ì˜ì—…ìš©'].mean()

    st.write("2023-2024 ì˜ì—…ìš© ìŠ¹ìš©ì°¨ ë³€ë™ ì¶”ì´")
    fig = px.scatter(df_recent, x="ì¼ì‹œ", y="ìŠ¹ìš©_ì˜ì—…ìš©", title="ì›”ë³„ ë“±ë¡ìˆ˜ ë³€í™”")

    st.plotly_chart(fig)

    col1, col2, col3 = st.columns(3)

    col1.metric("ğŸš— 2023 í‰ê·  ë“±ë¡ìˆ˜", f"{avg_2023:.0f}ëŒ€")
    col2.metric("ğŸš— 2024 í‰ê·  ë“±ë¡ìˆ˜", f"{avg_2024:.0f}ëŒ€")
    diff = avg_2024 - avg_2023
    rate = (diff / avg_2023) * 100
    col3.metric("ğŸ“‰ ì „ë…„ ëŒ€ë¹„ ë³€í™”", f"{diff:+.0f}ëŒ€", f"{rate:+.1f}%")
